(function(t){function e(e){for(var o,r,s=e[0],c=e[1],l=e[2],u=0,p=[];u<s.length;u++)r=s[u],Object.prototype.hasOwnProperty.call(i,r)&&i[r]&&p.push(i[r][0]),i[r]=0;for(o in c)Object.prototype.hasOwnProperty.call(c,o)&&(t[o]=c[o]);d&&d(e);while(p.length)p.shift()();return a.push.apply(a,l||[]),n()}function n(){for(var t,e=0;e<a.length;e++){for(var n=a[e],o=!0,s=1;s<n.length;s++){var c=n[s];0!==i[c]&&(o=!1)}o&&(a.splice(e--,1),t=r(r.s=n[0]))}return t}var o={},i={app:0},a=[];function r(e){if(o[e])return o[e].exports;var n=o[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=t,r.c=o,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)r.d(n,o,function(e){return t[e]}.bind(null,o));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],c=s.push.bind(s);s.push=e,s=s.slice();for(var l=0;l<s.length;l++)e(s[l]);var d=c;a.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("56d7")},"034f":function(t,e,n){"use strict";n("85ec")},"0463":function(t,e,n){},"2bc8":function(t,e,n){"use strict";n("5634")},5634:function(t,e,n){},"56d7":function(t,e,n){"use strict";n.r(e);n("e260"),n("e6cf"),n("cca6"),n("a79d");var o=n("2b0e"),i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("router-view")},a=[],r={name:"App",components:{}},s=r,c=(n("034f"),n("2877")),l=Object(c["a"])(s,i,a,!1,null,null,null),d=l.exports,u=n("bc3a"),p=n.n(u),m=n("8c4f"),f=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("div",{staticClass:"wrapper"},[n("div",{staticClass:"container"},[n("h1",[t._v("基于时空大数据的时间管理工具")]),n("form",{staticClass:"form",attrs:{onsubmit:"return false;"}},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.username,expression:"username"}],attrs:{type:"text",placeholder:"Username",name:"username",id:"username"},domProps:{value:t.username},on:{input:function(e){e.target.composing||(t.username=e.target.value)}}}),n("input",{directives:[{name:"model",rawName:"v-model",value:t.password,expression:"password"}],attrs:{type:"password",placeholder:"Password",name:"password",id:"password"},domProps:{value:t.password},on:{input:function(e){e.target.composing||(t.password=e.target.value)}}}),n("button",{attrs:{type:"submit",id:"login-button"},on:{click:t.submit}},[t._v("Login")])])]),t._m(0)])])},h=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("ul",{staticClass:"bg-bubbles"},[n("li"),n("li"),n("li"),n("li"),n("li"),n("li"),n("li"),n("li"),n("li"),n("li")])}],v={name:"Login.vue",data:function(){return{username:"",password:""}},methods:{submit:function(){var t=this;this.$axios({method:"post",url:"/login",data:{username:this.username,password:this.password}}).then((function(e){if(e.data.success){var n=e.data.data;t.$store.commit("set_token",n),t.$router.push("/home/todo")}else alert("用户名或密码错误, 请检查后重新输入")}))}}},g=v,b=(n("6941"),Object(c["a"])(g,f,h,!1,null,"1dedd163",null)),_=b.exports,k=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("div",{staticClass:"header"},[n("div",{staticClass:"box"},[n("div",{attrs:{id:"form"},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.commitTodo(e)}}},[n("label",{attrs:{for:"title"}},[t._v("ToDoList")]),n("div",{staticStyle:{float:"right",width:"60%"}},[n("label",{attrs:{for:"itemType"}}),n("select",{directives:[{name:"model",rawName:"v-model",value:t.todoType,expression:"todoType"}],attrs:{id:"itemType"},on:{change:function(e){var n=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.todoType=e.target.multiple?n:n[0]}}},[n("option",{attrs:{value:"single"}},[t._v("创建待办")]),n("option",{attrs:{value:"file"}},[t._v("下载文件")]),n("option",{attrs:{value:"note"}},[t._v("创建便签")])]),n("input",{directives:[{name:"model",rawName:"v-model",value:t.todoContent,expression:"todoContent"}],attrs:{type:"text",id:"title",placeholder:"添加ToDo",autocomplete:"off"},domProps:{value:t.todoContent},on:{input:function(e){e.target.composing||(t.todoContent=e.target.value)}}})])])])]),n("router-view",{staticClass:"container",attrs:{updateTodo:t.updateTodo,createPlaceHold:t.createPlaceHold}}),n("div",{staticClass:"footer",attrs:{id:"footerContainer"}},[t._v(" Copyright © "+t._s(t.year)+" LiZeC ")]),n("div",{staticClass:"footer",attrs:{id:"footerFunctionContainer"}},[n("a",{on:{click:t.selectFile}},[t._v("上传文件")]),t.isAdmin?n("a",{on:{click:t.backUpData}},[t._v("备份数据")]):t._e(),t.isAdmin?n("a",{on:{click:t.updateLogs}},[t._v("查看日志")]):t._e(),t.isAdmin?n("a",{on:{click:t.gc}},[t._v("垃圾回收")]):t._e(),n("a",{on:{click:t.doLogout}},[t._v("退出登录")])]),n("input",{staticStyle:{display:"none"},attrs:{type:"file",id:"file_selector"},on:{change:t.uploadFile}})],1)},y=[],x=(n("498a"),n("1276"),n("ac1f"),n("b0c0"),{name:"Main",data:function(){return{todoContent:"",todoType:"single",updateTodo:0,createPlaceHold:0,year:(new Date).getFullYear(),isAdmin:!1}},created:function(){var t=this;this.$axios.get("/meta/isAdmin").then((function(e){return t.isAdmin=e.data.data}))},methods:{commitTodo:function(){var t=this;if(""===this.todoContent.trim())alert("TODO不能为空");else if(/set (.+)/.test(this.todoContent)||/fun (.+)/.test(this.todoContent));else{var e=T(this.todoContent,this.todoType,this.$route.params.id);this.$axios.post("/item/create",e).then((function(){return t.updateTodo+=1})),this.todoContent="",this.todoType="single","file"===e.itemType&&(this.createPlaceHold+=1)}},doLogout:function(){this.$store.commit("del_token"),lt.push({path:"/login"})},selectFile:function(){document.getElementById("file_selector").click()},uploadFile:function(){var t=this,e=document.getElementById("file_selector").files[0];if(e){var n="/file/upload",o=new FormData;o.append("myFile",e);var i={headers:{"Content-Type":"multipart/form-data"}};this.$axios.post(n,o,i).then((function(){t.updateTodo+=1,console.log("Do Reload")}))}else alert("请先选择文件后再上传")},backUpData:function(){this.$router.push("/home/log/data")},updateLogs:function(){this.$router.push("/home/log/log")},gc:function(){this.$axios.post("/admin/gc").then((function(){return alert("垃圾回收完毕")}))}}});function T(t,e,n){var o=t.split(" "),i={itemType:e};1===o.length?i.name=t:i.name=o[0],i.itemType=$(i.name,i.itemType),void 0!==n&&(i.parent=n);for(var a=1;a<o.length;a++)"-"!==o[a].charAt(0)?i.name+=" "+o[a]:"-dl"===o[a]&&a+1<o.length?(i.deadline=o[a+1],a++):"-wk"===o[a]?i.work=!0:"-re"===o[a]?i.repeatable=!0:"-sp"===o[a]&&a+1<o.length&&(i.specific=o[a+1],a++);return i}function $(t,e){return"single"!==e?e:C(t)?"file":w(t)?"note":"single"}function C(t){var e=t.lastIndexOf("."),n=t.substring(e+1),o=["zip","jpg","png","exe","rar"];return-1!==o.indexOf(n)&&-1!==t.indexOf("http")&&confirm("检测到链接类型为文件, 是否按照文件类型进行下载?")}function w(t){for(var e=["计划","规划"],n=0,o=e;n<o.length;n++){var i=o[n];if(-1!==t.indexOf(i))return confirm("检测到代办类型包含关键词, 是否按照便签类型进行创建?")}return!1}var O=x,I=(n("e557"),Object(c["a"])(O,k,y,!1,null,"01b2cf3f",null)),A=I.exports,P=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("div",{staticClass:"span12",staticStyle:{"text-align":"center",padding:"5px"},attrs:{id:"editControls"}},[n("div",{staticClass:"btn-group"},[n("a",{staticClass:"btn",attrs:{href:"#"},on:{click:function(e){return t.doAction("h1")}}},[t._v("h"),n("sup",[t._v("1")])]),n("a",{staticClass:"btn",attrs:{href:"#"},on:{click:function(e){return t.doAction("h2")}}},[t._v("h"),n("sup",[t._v("2")])]),n("a",{staticClass:"btn",attrs:{href:"#"},on:{click:function(e){return t.doAction("p")}}},[t._v("p")]),n("a",{staticClass:"btn",attrs:{href:"#"},on:{click:function(e){return t.doAction("bold")}}},[n("b",[t._v("Bold")])]),n("a",{staticClass:"btn",attrs:{href:"#"},on:{click:function(e){return t.doAction("italic")}}},[n("em",[t._v("Italic")])]),n("a",{staticClass:"btn",attrs:{href:"#"},on:{click:function(e){return t.doAction("underline")}}},[t._m(0)]),n("a",{staticClass:"btn",attrs:{href:"#"},on:{click:function(e){return t.doAction("strikeThrough")}}},[n("del",[t._v("abc")])]),n("a",{staticClass:"btn",attrs:{href:"#"},on:{click:function(e){return t.doAction("undo")}}},[t._v("Undo")]),n("a",{staticClass:"btn",attrs:{href:"#"},on:{click:function(e){return t.doAction("redo")}}},[t._v("Redo")])])]),n("item-list",{attrs:{title:"正在进行","btn-name":"-",data:t.todo,done:!1},on:{"checkbox-change":t.finishTodoItem,"btn-click":t.removeTodo}}),n("div",{staticClass:"span12",attrs:{id:"editor",contenteditable:"true"}},[n("span",{domProps:{innerHTML:t._s(t.content)}})]),n("item-list",{attrs:{title:"已经完成","btn-name":"-",data:t.done,done:!0},on:{"checkbox-change":t.resetTodoItem,"btn-click":t.removeDone}}),n("div",{staticClass:"alert-none",attrs:{id:"alert"}},[t._v("保存成功")])],1)},j=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("u",[n("b",[t._v("U")])])}],E=(n("a9e3"),n("a434"),function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.data.length>0?n("div",[n("h2",[t._v(t._s(t.title)),n("span",{attrs:{id:"todoCount"}},[t._v(" "+t._s(t.data.length))])]),n("ol",{staticClass:"demo-box",attrs:{id:"todoList"}},t._l(t.data,(function(e,o){return n("li",{key:e.id,class:[t.done?"done":"",t.mapTypeToClass(e)],attrs:{id:"li-active"}},[n("label",[n("input",{attrs:{type:"checkbox"},domProps:{checked:t.done},on:{change:function(e){return t.change(o)}}})]),n("p",{on:{click:function(n){return t.jumpTo(e.url)}}},[t._v(t._s(t.mapName(e)))]),n("a",{on:{click:function(e){return t.click(o)}}},[t._v(t._s(t.btnName))])])})),0)]):t._e()}),L=[],N={name:"ItemList",props:{title:String,btnName:String,done:Boolean,data:Array},methods:{change:function(t){this.$emit("checkbox-change",t)},jumpTo:function(t){null!==t&&window.open(t)},click:function(t){this.$emit("btn-click",t)},mapTypeToClass:function(t){return t.repeatable?"repeatable":t.specific?"specific":t.urgent>0&&t.urgent<=4?"specific-"+t.urgent:"single"},mapName:function(t){var e=t.name;return"note"===t.item_type?e="【便签】"+t.name:"file"===t.item_type?e="【文件】"+t.name:null!==t.url&&(e="【链接】"+t.name),null!==t.deadline&&(e="【"+t.deadline.split(" ")[0]+"】"+e),t.work&&(e="【工作】"+e),t.specific&&(e="【"+S(t.specific)+"】"+e),e}}};function S(t){var e=["周一","周二","周三","周四","周五","周六","周日"];return e[t-1]}var F=N,D=(n("b5a2"),Object(c["a"])(F,E,L,!1,null,"5522cc60",null)),H=D.exports,B={name:"NoteComponent",components:{ItemList:H},props:{updateTodo:Number,createPlaceHold:Number},data:function(){return{done:[],todo:[],old:[],content:"",lastContent:void 0}},created:function(){var t=this;this.$axios.post("/note/getAll",{id:this.$route.params.id}).then((function(e){t.todo=e.data.data.todo,t.done=e.data.data.done,t.old=e.data.data.old})),this.$axios.post("/item/getTitle",{id:this.$route.params.id}).then((function(t){return document.title=t.data.data})),this.$axios.post("/note/content",{id:this.$route.params.id}).then((function(e){return t.content=e.data.data})),document.onkeydown=this.save,setInterval((function(){var e=document.getElementById("editor").innerHTML;e!==t.lastContent&&(console.log(["autoSave",e]),t.lastContent=e,t.$axios.post("note/update",{id:t.$route.params.id,content:e}))}),6e4)},methods:{finishTodoItem:function(t){var e=this;this.$axios.post("/item/done",{id:this.todo[t].id,parent:this.$route.params.id}).then((function(n){e.done.unshift(e.todo[t]),e.todo=n.data.data}))},resetTodoItem:function(t){var e=this;this.$axios.post("/item/undone",{id:this.done[t].id,parent:this.$route.params.id}).then((function(n){e.done.splice(t,1),e.todo=n.data.data}))},removeTodo:function(t){var e=this;this.$axios.post("/item/remove",{id:this.todo[t].id,parent:this.$route.params.id}).then((function(){return e.todo.splice(t,1)}))},removeDone:function(t){var e=this;this.$axios.post("/item/remove",{id:this.done[t].id,parent:this.$route.params.id}).then((function(){return e.done.splice(t,1)}))},save:function(t){t.ctrlKey&&83===t.keyCode&&(t.preventDefault(),this.$axios.post("note/update",{id:this.$route.params.id,content:document.getElementById("editor").innerHTML}).then((function(){M(),setTimeout(U,500)})))},doAction:function(t){var e=["h1","h2","p"];-1!==e.indexOf(t)?document.execCommand("formatBlock",!1,"<"+t+">"):document.execCommand(t,!1,null)}},watch:{updateTodo:function(){var t=this;this.$axios.post("/note/getTodo",{id:this.$route.params.id}).then((function(e){return t.todo=e.data.data}))},createPlaceHold:function(){this.todo.unshift({id:1,name:"文件正在下载,请稍等...",item_type:"file",urgent:0,deadline:null,old:!1,repeatable:!1,specific:0,work:!1,url:"#"})}}};function M(){document.getElementById("alert").className="alert-show"}function U(){document.getElementById("alert").className="alert-none"}var R=B,G=(n("2bc8"),Object(c["a"])(R,P,j,!1,null,"00b564f3",null)),J=G.exports,q=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("item-list",{attrs:{title:"公共空间","btn-name":"-",data:t.publicFiles,done:!1},on:{"checkbox-change":t.refresh,"btn-click":t.remove}}),n("p",{staticStyle:{margin:"auto","text-align":"center"}},[t._v("公共空间的文件在24小时后自动删除")])],1)},z=[],K={name:"FileComponent",components:{ItemList:H},props:{updateTodo:Number},data:function(){return{publicFiles:[]}},created:function(){var t=this;this.$axios.post("/file/getAll").then((function(e){return t.publicFiles=e.data.data}))},methods:{refresh:function(){console.warn("刷新功能不可用")},remove:function(t){var e=this;this.$axios.post("/item/remove",{id:this.publicFiles[t].id}).then((function(){return e.publicFiles.splice(t,1)}))}},watch:{updateTodo:function(){var t=this;this.$axios.post("/file/getAll").then((function(e){return t.publicFiles=e.data.data}))}}},Y=K,Z=Object(c["a"])(Y,q,z,!1,null,"c5aa0a4e",null),Q=Z.exports,V=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("item-list",{attrs:{title:"正在进行","btn-name":"↓",data:t.todo,done:!1},on:{"checkbox-change":t.finishTodoItem,"btn-click":t.promotion}}),n("item-list",{attrs:{title:"已经完成","btn-name":"-",data:t.done,done:!0},on:{"checkbox-change":t.resetTodoItem,"btn-click":t.removeDone}}),n("item-list",{attrs:{title:"长期任务","btn-name":"-",data:t.old,done:!1},on:{"btn-click":t.removeOld}})],1)},W=[],X={name:"TodoComponent",components:{ItemList:H},props:{updateTodo:Number,createPlaceHold:Number},data:function(){return{done:[],todo:[],old:[]}},created:function(){var t=this;this.$axios.post("/item/getAll").then((function(e){t.todo=e.data.data.todo,t.done=e.data.data.done,t.old=e.data.data.old}))},methods:{finishTodoItem:function(t){var e=this;this.$axios.post("/item/done",{id:this.todo[t].id}).then((function(n){e.done.unshift(e.todo[t]),e.todo=n.data.data}))},resetTodoItem:function(t){var e=this;this.$axios.post("/item/undone",{id:this.done[t].id}).then((function(n){e.done.splice(t,1),e.todo=n.data.data}))},removeDone:function(t){var e=this;this.$axios.post("/item/remove",{id:this.done[t].id}).then((function(){return e.done.splice(t,1)}))},removeOld:function(t){var e=this;this.$axios.post("/item/remove",{id:this.old[t].id}).then((function(){return e.old.splice(t,1)}))},promotion:function(t){var e=this;this.$axios.post("/item/toOld",{id:this.todo[t].id}).then((function(){e.old.unshift(e.todo[t]),e.todo.splice(t,1)}))}},watch:{updateTodo:function(){var t=this;this.$axios.post("/item/getTodo").then((function(e){return t.todo=e.data.data}))},createPlaceHold:function(){this.todo.unshift({id:1,name:"文件正在下载,请稍等...",item_type:"file",urgent:0,deadline:null,old:!1,repeatable:!1,specific:0,work:!1,url:"#"})}}},tt=X,et=Object(c["a"])(tt,V,W,!1,null,"08a82152",null),nt=et.exports,ot=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("h2",[t._v(t._s(t.title))]),n("textarea",{directives:[{name:"model",rawName:"v-model",value:t.content,expression:"content"}],attrs:{id:"editor"},domProps:{value:t.content},on:{input:function(e){e.target.composing||(t.content=e.target.value)}}})])},it=[],at={name:"LogTypeComponent",data:function(){return{title:"",content:""}},created:function(){var t=this,e=this.$route.params.type;switch(e){case"data":this.title="用户数据";break;case"log":this.title="系统日志";break;default:console.warn("无效的类型"),this.title="数据"}document.title=this.title,this.$axios.get("/log/"+e).then((function(e){return t.content=e.data.data}))}},rt=at,st=(n("d5cc"),Object(c["a"])(rt,ot,it,!1,null,"53a26962",null)),ct=st.exports;o["a"].use(m["a"]);var lt=new m["a"]({mode:"history",routes:[{path:"/",redirect:"/home/todo"},{path:"/login",component:_},{path:"/home",component:A,children:[{path:"todo",component:nt},{path:"note/:id",component:J},{path:"log/:type",component:ct},{path:"file",component:Q}]}]}),dt=n("2f62");o["a"].use(dt["a"]);var ut=new dt["a"].Store({state:{token:""},mutations:{set_token:function(t,e){t.token=e,localStorage.token=e},del_token:function(t){t.token="",localStorage.removeItem("token")}}});o["a"].config.productionTip=!1,o["a"].prototype.$axios=p.a,p.a.defaults.baseURL="/api",p.a.interceptors.request.use((function(t){return ut.state.token&&(t.headers.common["Token"]=ut.state.token),t}));var pt=function(){};p.a.interceptors.response.use((function(t){return t.data.success||(ut.commit("del_token"),lt.push({path:"/login"}).then(pt)),t})),localStorage.getItem("token")&&ut.commit("set_token",localStorage.getItem("token")),lt.beforeEach((function(t,e,n){console.log(["In router beforeEach, Token = ",ut.state.token]);var o=ut.state.token;o||"/login"===t.path||(console.log("GOTO Login Page"),lt.push({path:"/login"}).then(pt)),"/login"===t.path&&o&&(console.log("GOTO Home Page"),lt.push({path:"/home/todo"}).then(pt)),n()})),new o["a"]({render:function(t){return t(d)},router:lt,store:ut}).$mount("#app")},6941:function(t,e,n){"use strict";n("0463")},8519:function(t,e,n){},"85ec":function(t,e,n){},a8c4:function(t,e,n){},aa26:function(t,e,n){},b5a2:function(t,e,n){"use strict";n("a8c4")},d5cc:function(t,e,n){"use strict";n("8519")},e557:function(t,e,n){"use strict";n("aa26")}});
//# sourceMappingURL=app.35343035.js.map